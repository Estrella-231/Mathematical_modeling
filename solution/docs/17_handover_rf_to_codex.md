# å·¥ä½œäº¤æ¥æŠ¥å‘Šï¼šModel B2 (Random Forest) + SHAP åˆ†æ

**æ‰§è¡Œæ—¶é—´**: 2026-01-30 ä¸‹åˆ
**æ‰§è¡Œè€…**: Claude Code
**äº¤æ¥å¯¹è±¡**: Codex (Code Review)
**å·¥ä½œæµé˜¶æ®µ**: Phase E (Model B2 å®ç°) â†’ Phase F (Code Review)

---

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

æ ¹æ® `docs/09_model_b2_rf_impl.md` çš„æ–¹æ¡ˆï¼Œå®ç° Random Forest æ¨¡å‹ç”¨äºåˆ†æç²‰ä¸åå¥½çš„é©±åŠ¨å› ç´ ï¼Œå¹¶ä½¿ç”¨ SHAP å€¼è¿›è¡Œæ·±åº¦è§£é‡Šã€‚

**æ ¸å¿ƒç›®æ ‡**ï¼š
1. è§£é‡Š Model B1 æå–çš„ç²‰ä¸æŠ•ç¥¨æ®‹å·®
2. è¯†åˆ«å“ªäº›é€‰æ‰‹ç‰¹å¾ï¼ˆå¹´é¾„ã€è¡Œä¸šã€èˆä¼´ï¼‰é©±åŠ¨ç²‰ä¸æŠ•ç¥¨
3. éªŒè¯ B1 æå–çš„æ®‹å·®æ˜¯å¦å…·æœ‰ç»Ÿè®¡è§„å¾‹
4. ä½¿ç”¨ SHAP å€¼è¿›è¡Œæ·±åº¦ç‰¹å¾å½±å“åˆ†æ

---

## ğŸ“‚ è¾“å…¥ææ–™

### å‚è€ƒæ–‡æ¡£
- `docs/09_model_b2_rf_impl.md` - Random Forest å®ç°æ–¹æ¡ˆ
- `docs/08_model_b1_ridge_impl.md` - Ridge æ¨¡å‹æ–¹æ¡ˆï¼ˆæä¾›æ®‹å·®ï¼‰
- `WORKFLOW.md` - é¡¹ç›®å·¥ä½œæµ
- `RUNBOOK.md` - æ“ä½œæ‰‹å†Œ

### è¾“å…¥æ•°æ®
- `Data/models/ridge_v2/ridge_fan_vote_shares_v2.csv` - Ridge V2 çš„æ®‹å·®ï¼ˆè®­ç»ƒé›†ï¼‰
- `Data/models/ridge_v2/ridge_fan_vote_shares_v2_test.csv` - Ridge V2 çš„æ®‹å·®ï¼ˆæµ‹è¯•é›†ï¼‰
- `Data/processed/weekly_panel.csv` - å‘¨çº§é¢æ¿æ•°æ®

---

## ğŸ”§ å®ç°å†…å®¹

### 1. Random Forest æ¨¡å‹å®ç°

**æ–‡ä»¶**: `src/models/random_forest_model.py`

**æ ¸å¿ƒç±»**: `RandomForestFanPreferenceModel`

**ç‰¹å¾è®¾è®¡**ï¼ˆ10 ä¸ªç‰¹å¾ï¼‰:

**é™æ€ç‰¹å¾**ï¼ˆé€‰æ‰‹å›ºæœ‰å±æ€§ï¼‰:
- `age`: å¹´é¾„ï¼ˆè¿ç»­å˜é‡ï¼‰
- `age_group`: å¹´é¾„åˆ†ç»„ï¼ˆ<25, 25-35, 35-45, 45-55, 55+ï¼‰
- `industry`: è¡Œä¸šï¼ˆActor/Actress, Athlete, Singer, TV Personality ç­‰ï¼‰
- `homestate`: å·
- `partner`: èˆä¼´

**åŠ¨æ€ç‰¹å¾**ï¼ˆæ¯”èµ›è¿‡ç¨‹ä¸­çš„è¡¨ç°ï¼‰:
- `relative_judge_score`: Z-Scoreï¼ˆæ ‡å‡†åŒ–è¯„å§”åˆ†ï¼‰
- `cumulative_average`: ç´¯ç§¯å¹³å‡åˆ†
- `trend`: æœ¬å‘¨åˆ† - ä¸Šå‘¨åˆ†
- `judge_rank_in_week`: å‘¨å†…æ’å
- `week`: å‘¨æ•°

**æ¨¡å‹å‚æ•°**:
```python
RandomForestRegressor(
    n_estimators=100,      # æ ‘çš„æ•°é‡
    max_depth=10,          # æ ‘çš„æœ€å¤§æ·±åº¦
    random_state=42,       # éšæœºç§å­
    n_jobs=-1              # ä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒ
)
```

**å…³é”®æ–¹æ³•**:
- `prepare_features()`: å‡†å¤‡ç‰¹å¾çŸ©é˜µï¼Œä½¿ç”¨ LabelEncoder ç¼–ç åˆ†ç±»ç‰¹å¾
- `fit()`: è®­ç»ƒæ¨¡å‹ï¼ŒåŒ…å« 5-Fold äº¤å‰éªŒè¯
- `predict()`: é¢„æµ‹æ®‹å·®
- `get_feature_importance()`: è·å–ç‰¹å¾é‡è¦æ€§
- `analyze_feature_importance()`: åˆ†æå¹¶æ‰“å°ç‰¹å¾é‡è¦æ€§

---

### 2. SHAP åˆ†æå®ç°

**æ–‡ä»¶**: `src/shap_analysis.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- ä½¿ç”¨ `shap.TreeExplainer` è®¡ç®— SHAP å€¼ï¼ˆé’ˆå¯¹æ ‘æ¨¡å‹ä¼˜åŒ–ï¼‰
- ç”Ÿæˆå¤šç§ SHAP å¯è§†åŒ–
- åˆ†æå…³é”®ç‰¹å¾çš„å½±å“æ¨¡å¼

**ç”Ÿæˆçš„å¯è§†åŒ–**ï¼ˆ10 å¼ å›¾è¡¨ï¼‰:
1. **SHAP Summary Plot** - æœ€é‡è¦çš„å›¾ï¼Œæ˜¾ç¤ºæ‰€æœ‰ç‰¹å¾å¯¹æ‰€æœ‰æ ·æœ¬çš„å½±å“
2. **SHAP Bar Plot** - ç‰¹å¾é‡è¦æ€§æ¡å½¢å›¾
3. **SHAP Dependence Plots** (5 å¼ ) - Top 5 ç‰¹å¾çš„ä¾èµ–å…³ç³»å›¾
   - cumulative_average
   - age
   - week
   - partner
   - judge_rank_in_week
4. **SHAP Force Plots** (3 å¼ ) - å•ä¸ªæ ·æœ¬çš„è¯¦ç»†è§£é‡Š
   - æœ€é«˜ç²‰ä¸æ”¯æŒæ ·æœ¬
   - æœ€ä½ç²‰ä¸æ”¯æŒæ ·æœ¬
   - ä¸­ä½æ•°æ ·æœ¬

---

### 3. å¯è§†åŒ–è„šæœ¬

**æ–‡ä»¶**: `src/visualize_random_forest.py`

**ç”Ÿæˆçš„å›¾è¡¨**ï¼ˆ6 å¼ ï¼‰:
1. `feature_importance.png` - ç‰¹å¾é‡è¦æ€§æ¡å½¢å›¾ï¼ˆé¢œè‰²åŒºåˆ†é™æ€/åŠ¨æ€ï¼‰
2. `actual_vs_predicted.png` - å®é™… vs é¢„æµ‹æ®‹å·®æ•£ç‚¹å›¾
3. `residual_distributions.png` - æ®‹å·®åˆ†å¸ƒå¯¹æ¯”
4. `fan_effect_by_age.png` - æŒ‰å¹´é¾„ç»„çš„ç²‰ä¸æ•ˆåº”
5. `fan_effect_by_industry.png` - æŒ‰è¡Œä¸šçš„ç²‰ä¸æ•ˆåº”
6. `feature_importance_pie.png` - é™æ€ vs åŠ¨æ€ç‰¹å¾å æ¯”

---

### 4. é—®é¢˜ä¿®å¤

#### ä¿®å¤ 1: Ridge V2 æµ‹è¯•é›†ç¼ºå¤±

**ä¿®æ”¹æ–‡ä»¶**: `src/models/ridge_model_v2.py`

**ä¿®æ”¹å†…å®¹**:
- åœ¨æµ‹è¯•é›†éªŒè¯éƒ¨åˆ†æ·»åŠ æ®‹å·®è®¡ç®—
- ä¿å­˜æµ‹è¯•é›†çš„æ®‹å·®å’Œç²‰ä¸æŠ•ç¥¨ä»½é¢åˆ° CSV

**æ–°å¢è¾“å‡º**:
- `ridge_fan_vote_shares_v2_test.csv`

#### ä¿®å¤ 2: æ·»åŠ  SHAP åˆ†æ

**æ–°å¢æ–‡ä»¶**: `src/shap_analysis.py`

**ä¾èµ–å®‰è£…**:
```bash
pip install shap
```

---

## ğŸ“Š å…³é”®ç»“æœ

### Random Forest æ¨¡å‹æ€§èƒ½

**è®­ç»ƒé›†**:
- **RÂ² Score**: 0.7381 â­
- **RMSE**: 0.8103
- **MAE**: 0.6221

**5-Fold äº¤å‰éªŒè¯**:
- **CV RÂ² å‡å€¼**: -0.0775 âš ï¸
- **CV RÂ² æ ‡å‡†å·®**: 0.1948

**è§£è¯»**:
- è®­ç»ƒé›† RÂ² = 0.74 è¯´æ˜æ¨¡å‹èƒ½è§£é‡Š 74% çš„æ®‹å·®æ–¹å·®
- äº¤å‰éªŒè¯ RÂ² = -0.08 è¯´æ˜å­˜åœ¨ä¸¥é‡è¿‡æ‹Ÿåˆ
- æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šè®°ä½äº†æ•°æ®ï¼Œä½†æ— æ³•æ³›åŒ–

---

### Random Forest ç‰¹å¾é‡è¦æ€§

| æ’å | ç‰¹å¾ | é‡è¦æ€§ | ç±»å‹ |
|------|------|--------|------|
| 1 | **age** | 20.6% | é™æ€ |
| 2 | cumulative_average | 15.2% | åŠ¨æ€ |
| 3 | **partner** | 14.2% | é™æ€ |
| 4 | **homestate** | 12.9% | é™æ€ |
| 5 | relative_judge_score | 11.1% | åŠ¨æ€ |
| 6 | week | 6.9% | åŠ¨æ€ |
| 7 | industry | 5.9% | é™æ€ |
| 8 | trend | 5.8% | åŠ¨æ€ |
| 9 | judge_rank_in_week | 5.7% | åŠ¨æ€ |
| 10 | age_group | 1.6% | é™æ€ |

**æŒ‰ç±»åˆ«æ±‡æ€»**:
- é™æ€ç‰¹å¾ï¼ˆå¹´é¾„ã€è¡Œä¸šã€å·ã€èˆä¼´ï¼‰: **34.65%**
- åŠ¨æ€ç‰¹å¾ï¼ˆè¯„å§”åˆ†ã€è¶‹åŠ¿ç­‰ï¼‰: **65.35%**

---

### SHAP åˆ†æç»“æœ

#### SHAP ç‰¹å¾é‡è¦æ€§ï¼ˆæ›´å‡†ç¡®ï¼‰

| æ’å | ç‰¹å¾ | SHAP é‡è¦æ€§ | RF é‡è¦æ€§ | å·®å¼‚ |
|------|------|-------------|-----------|------|
| 1 | **cumulative_average** | 30.3% | 15.2% | â†‘ â­ |
| 2 | **age** | 26.4% | 20.6% | - |
| 3 | **week** | 23.3% | 6.9% | â†‘â†‘ â­â­ |
| 4 | **partner** | 13.1% | 14.2% | - |
| 5 | judge_rank_in_week | 9.4% | 5.7% | â†‘ |
| 6 | trend | 8.0% | 5.8% | â†‘ |
| 7 | relative_judge_score | 7.2% | 11.1% | â†“ |
| 8 | industry | 7.2% | 5.9% | â†‘ |
| 9 | **homestate** | 6.3% | 12.9% | â†“â†“ âš ï¸ |
| 10 | age_group | 2.3% | 1.6% | â†‘ |

**å…³é”®å·®å¼‚**:
1. **week** çš„é‡è¦æ€§è¢« RF ä¸¥é‡ä½ä¼°ï¼ˆ6.9% â†’ 23.3%ï¼‰
2. **homestate** çš„é‡è¦æ€§è¢« RF é«˜ä¼°ï¼ˆ12.9% â†’ 6.3%ï¼‰
3. **cumulative_average** æ˜¯æœ€é‡è¦çš„ç‰¹å¾ï¼ˆ30.3%ï¼‰

**ç»“è®º**: SHAP æä¾›äº†æ›´å‡†ç¡®çš„ç‰¹å¾å½±å“è¯„ä¼°

---

#### å¹´é¾„çš„éçº¿æ€§å½±å“ â­

**æŒ‰å¹´é¾„ç»„çš„å¹³å‡ SHAP å€¼**:
- **<30 å²**: +0.1863ï¼ˆæ­£é¢å½±å“ï¼Œç²‰ä¸æ”¯æŒé«˜ï¼‰âœ…
- **30-40 å²**: +0.1670ï¼ˆæ­£é¢å½±å“ï¼‰âœ…
- **40-50 å²**: -0.3158ï¼ˆè´Ÿé¢å½±å“ï¼Œç²‰ä¸æ”¯æŒä½ï¼‰âš ï¸
- **50+ å²**: -0.3537ï¼ˆè´Ÿé¢å½±å“ï¼‰âš ï¸

**å…³é”®å‘ç°**:
- 40 å²æ˜¯æ˜æ˜¾çš„åˆ†æ°´å²­
- å¹´è½»é€‰æ‰‹ï¼ˆ<40 å²ï¼‰æ›´å—ç²‰ä¸æ¬¢è¿
- ä¸­å¹´é€‰æ‰‹ï¼ˆ40-50 å²ï¼‰ç²‰ä¸æ”¯æŒæ˜¾è‘—ä¸‹é™

---

#### èˆä¼´çš„å½±å“èŒƒå›´

**SHAP å€¼èŒƒå›´**: [-0.7280, 0.7600]

**è§£è¯»**:
- ä¸åŒèˆä¼´å¯¹ç²‰ä¸æŠ•ç¥¨çš„å½±å“å·®å¼‚å·¨å¤§
- æœ€å¥½çš„èˆä¼´å¯ä»¥å¸¦æ¥ +0.76 çš„ SHAP å€¼
- æœ€å·®çš„èˆä¼´å¯ä»¥å¸¦æ¥ -0.73 çš„ SHAP å€¼
- èˆä¼´é€‰æ‹©è‡³å…³é‡è¦

---

## ğŸ“ è¾“å‡ºæ–‡ä»¶

### ä»£ç æ–‡ä»¶ï¼ˆ3 ä¸ªï¼‰
```
src/
â”œâ”€â”€ models/
â”‚   â””â”€â”€ random_forest_model.py (RF æ¨¡å‹å®ç°)
â”œâ”€â”€ visualize_random_forest.py (RF å¯è§†åŒ–)
â””â”€â”€ shap_analysis.py (SHAP åˆ†æ)
```

### æ¨¡å‹æ–‡ä»¶ï¼ˆ3 ä¸ªï¼‰
```
Data/models/random_forest/
â”œâ”€â”€ random_forest_model.pkl (è®­ç»ƒå¥½çš„æ¨¡å‹)
â”œâ”€â”€ feature_importance.csv (ç‰¹å¾é‡è¦æ€§)
â””â”€â”€ rf_predictions.csv (é¢„æµ‹ç»“æœ)
```

### å¯è§†åŒ–æ–‡ä»¶ï¼ˆ16 å¼ å›¾è¡¨ï¼‰
```
figures/
â”œâ”€â”€ random_forest/ (6 å¼ )
â”‚   â”œâ”€â”€ feature_importance.png
â”‚   â”œâ”€â”€ actual_vs_predicted.png
â”‚   â”œâ”€â”€ residual_distributions.png
â”‚   â”œâ”€â”€ fan_effect_by_age.png
â”‚   â”œâ”€â”€ fan_effect_by_industry.png
â”‚   â””â”€â”€ feature_importance_pie.png
â””â”€â”€ shap_analysis/ (10 å¼ )
    â”œâ”€â”€ shap_summary_plot.png â­â­â­
    â”œâ”€â”€ shap_bar_plot.png
    â”œâ”€â”€ shap_dependence_age.png â­
    â”œâ”€â”€ shap_dependence_cumulative_average.png
    â”œâ”€â”€ shap_dependence_week.png â­
    â”œâ”€â”€ shap_dependence_partner.png â­
    â”œâ”€â”€ shap_dependence_judge_rank_in_week.png
    â”œâ”€â”€ shap_force_highest_fan_support.png
    â”œâ”€â”€ shap_force_lowest_fan_support.png
    â””â”€â”€ shap_force_median_fan_support.png
```

### æ–‡æ¡£æ–‡ä»¶ï¼ˆ4 ä¸ªï¼‰
```
docs/
â”œâ”€â”€ 14_model_b2_report.md (RF è¯¦ç»†æŠ¥å‘Š)
â”œâ”€â”€ 15_model_b2_summary.md (RF æ€»ç»“)
â”œâ”€â”€ 16_fixes_and_shap_report.md (ä¿®å¤å’Œ SHAP æŠ¥å‘Š)
â””â”€â”€ 06_decision_log.md (å·²æ›´æ–°)
```

---

## ğŸ” éœ€è¦ Review çš„å…³é”®ç‚¹

### 1. ä»£ç è´¨é‡ â­â­â­

- [ ] **æ¨¡å‹å®ç°æ­£ç¡®æ€§**
  - RandomForestRegressor çš„å‚æ•°è®¾ç½®æ˜¯å¦åˆç†ï¼Ÿ
  - ç‰¹å¾å‡†å¤‡é€»è¾‘æ˜¯å¦æ­£ç¡®ï¼Ÿ
  - LabelEncoder çš„ä½¿ç”¨æ˜¯å¦åˆé€‚ï¼Ÿï¼ˆå¯èƒ½å¼•å…¥è™šå‡é¡ºåºï¼‰

- [ ] **SHAP åˆ†ææ­£ç¡®æ€§**
  - TreeExplainer çš„ä½¿ç”¨æ˜¯å¦æ­£ç¡®ï¼Ÿ
  - SHAP å€¼çš„è®¡ç®—å’Œè§£é‡Šæ˜¯å¦å‡†ç¡®ï¼Ÿ
  - æ ·æœ¬é€‰æ‹©ï¼ˆ500 ä¸ªï¼‰æ˜¯å¦åˆç†ï¼Ÿ

- [ ] **ä»£ç ç»“æ„**
  - ç±»çš„è®¾è®¡æ˜¯å¦åˆç†ï¼Ÿ
  - æ–¹æ³•çš„èŒè´£æ˜¯å¦æ¸…æ™°ï¼Ÿ
  - ä»£ç å¤ç”¨æ€§å¦‚ä½•ï¼Ÿ

### 2. è¿‡æ‹Ÿåˆé—®é¢˜ â­â­â­

- [ ] **ä¸¥é‡è¿‡æ‹Ÿåˆ**
  - è®­ç»ƒé›† RÂ² = 0.74ï¼Œäº¤å‰éªŒè¯ RÂ² = -0.08
  - max_depth = 10 æ˜¯å¦å¤ªæ·±ï¼Ÿ
  - æ˜¯å¦éœ€è¦å¢åŠ æ­£åˆ™åŒ–ï¼Ÿ

- [ ] **è§£å†³æ–¹æ¡ˆ**
  - å‡å° max_depth åˆ° 5ï¼Ÿ
  - å¢åŠ  min_samples_split å’Œ min_samples_leafï¼Ÿ
  - ä½¿ç”¨ max_features é™åˆ¶æ¯æ¬¡åˆ†è£‚çš„ç‰¹å¾æ•°ï¼Ÿ

### 3. ç‰¹å¾å·¥ç¨‹ â­â­

- [ ] **ç‰¹å¾ç¼–ç é—®é¢˜**
  - LabelEncoder å¯¹åˆ†ç±»ç‰¹å¾ç¼–ç ï¼Œå¼•å…¥äº†è™šå‡çš„é¡ºåºå…³ç³»
  - åº”è¯¥ä½¿ç”¨ One-Hot Encodingï¼Ÿ
  - ä½† One-Hot ä¼šå¯¼è‡´ç»´åº¦çˆ†ç‚¸ï¼ˆèˆä¼´æœ‰ 100+ ä¸ªï¼‰

- [ ] **ç¼ºå¤±ç‰¹å¾**
  - æ˜¯å¦éœ€è¦æ·»åŠ äº¤äº’ç‰¹å¾ï¼ˆage Ã— industryï¼‰ï¼Ÿ
  - æ˜¯å¦éœ€è¦æ·»åŠ éçº¿æ€§å˜æ¢ï¼ˆageÂ²ï¼‰ï¼Ÿ
  - æ˜¯å¦éœ€è¦æ·»åŠ æ—¶é—´ç‰¹å¾ï¼ˆis_early_weekï¼‰ï¼Ÿ

### 4. SHAP åˆ†æ â­â­

- [ ] **æ ·æœ¬é€‰æ‹©**
  - åªä½¿ç”¨äº† 500 ä¸ªæ ·æœ¬è®¡ç®— SHAP å€¼
  - æ˜¯å¦è¶³å¤Ÿä»£è¡¨æ•´ä½“ï¼Ÿ
  - æ˜¯å¦éœ€è¦å¢åŠ æ ·æœ¬æ•°ï¼Ÿ

- [ ] **å¯è§†åŒ–è´¨é‡**
  - SHAP plots æ˜¯å¦æ¸…æ™°æ˜“æ‡‚ï¼Ÿ
  - æ˜¯å¦éœ€è¦æ·»åŠ æ›´å¤šè§£é‡Šï¼Ÿ

### 5. æµ‹è¯•é›†éªŒè¯ â­â­â­

- [ ] **æµ‹è¯•é›†ç¼ºå¤±**
  - å½“å‰åªåœ¨è®­ç»ƒé›†ï¼ˆS1-S27ï¼‰ä¸Šè®­ç»ƒå’ŒéªŒè¯
  - è™½ç„¶ç”Ÿæˆäº†æµ‹è¯•é›†æ®‹å·®ï¼Œä½†æ²¡æœ‰åœ¨æµ‹è¯•é›†ä¸ŠéªŒè¯ RF æ¨¡å‹
  - éœ€è¦åœ¨ S28-S34 ä¸Šæµ‹è¯• RF çš„æ³›åŒ–èƒ½åŠ›

### 6. æ€§èƒ½é—®é¢˜ â­

- [ ] **è®¡ç®—æ•ˆç‡**
  - SHAP è®¡ç®—æ˜¯å¦æœ‰æ€§èƒ½ç“¶é¢ˆï¼Ÿ
  - æ˜¯å¦å¯ä»¥ä¼˜åŒ–ï¼Ÿ

- [ ] **å†…å­˜ä½¿ç”¨**
  - å¤§æ•°æ®é›†æ˜¯å¦ä¼šæœ‰å†…å­˜é—®é¢˜ï¼Ÿ

### 7. æ–‡æ¡£å®Œæ•´æ€§ â­â­

- [ ] **æ–¹æ¡ˆä¸€è‡´æ€§**
  - ä»£ç å®ç°æ˜¯å¦ä¸ `docs/09_model_b2_rf_impl.md` ä¸€è‡´ï¼Ÿ
  - æ˜¯å¦å®Œæˆäº†æ–¹æ¡ˆä¸­çš„æ‰€æœ‰è¦æ±‚ï¼Ÿ

- [ ] **å†³ç­–è®°å½•**
  - å…³é”®å†³ç­–æ˜¯å¦éƒ½è®°å½•åœ¨ `docs/06_decision_log.md`ï¼Ÿ

---

## âš ï¸ å·²çŸ¥é—®é¢˜å’Œå±€é™æ€§

### 1. ä¸¥é‡è¿‡æ‹Ÿåˆ âš ï¸âš ï¸âš ï¸

**é—®é¢˜**: è®­ç»ƒé›† RÂ² = 0.74ï¼Œäº¤å‰éªŒè¯ RÂ² = -0.08

**åŸå› **:
- max_depth = 10 å¤ªæ·±
- æ ·æœ¬é‡ç›¸å¯¹è¾ƒå°ï¼ˆ2,014ï¼‰
- ç‰¹å¾ç¼–ç é—®é¢˜ï¼ˆLabelEncoderï¼‰

**å½±å“**:
- æ¨¡å‹æ— æ³•æ³›åŒ–åˆ°æ–°æ•°æ®
- ç‰¹å¾é‡è¦æ€§å¯èƒ½ä¸å‡†ç¡®
- SHAP åˆ†æçš„ç»“è®ºå¯èƒ½æœ‰åå·®

**è§£å†³æ–¹æ¡ˆ**:
```python
RandomForestRegressor(
    n_estimators=100,
    max_depth=5,              # ä» 10 é™åˆ° 5
    min_samples_split=20,     # å¢åŠ 
    min_samples_leaf=10,      # å¢åŠ 
    max_features='sqrt',      # å¢åŠ æ­£åˆ™åŒ–
    random_state=42
)
```

### 2. ç‰¹å¾ç¼–ç é—®é¢˜ âš ï¸âš ï¸

**é—®é¢˜**: ä½¿ç”¨ LabelEncoder å¯¹åˆ†ç±»ç‰¹å¾ç¼–ç 

**å½±å“**:
- å¼•å…¥äº†è™šå‡çš„é¡ºåºå…³ç³»
- ä¾‹å¦‚ï¼špartner_encoded = [0, 1, 2, ...] æš—ç¤ºèˆä¼´ä¹‹é—´æœ‰é¡ºåº
- å¯èƒ½å¯¼è‡´æ¨¡å‹å­¦åˆ°é”™è¯¯çš„æ¨¡å¼

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨ One-Hot Encoding
- ä½†éœ€è¦å¤„ç†é«˜åŸºæ•°ç‰¹å¾ï¼ˆèˆä¼´æœ‰ 100+ ä¸ªï¼‰
- å¯ä»¥ä½¿ç”¨ Target Encoding æˆ– Frequency Encoding

### 3. æµ‹è¯•é›†æœªéªŒè¯ âš ï¸

**é—®é¢˜**: RF æ¨¡å‹åªåœ¨è®­ç»ƒé›†ä¸ŠéªŒè¯ï¼Œæ²¡æœ‰åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•

**å½±å“**:
- ä¸çŸ¥é“æ¨¡å‹åœ¨ S28-S34 ä¸Šçš„è¡¨ç°
- æ— æ³•è¯„ä¼°æ¨¡å‹å¯¹è§„åˆ™å˜æ›´çš„é€‚åº”æ€§

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨æ–°ç”Ÿæˆçš„ `ridge_fan_vote_shares_v2_test.csv`
- åœ¨æµ‹è¯•é›†ä¸Šè¿è¡Œ RF æ¨¡å‹
- æŠ¥å‘Šæµ‹è¯•é›†æ€§èƒ½

### 4. SHAP æ ·æœ¬é‡è¾ƒå° âš ï¸

**é—®é¢˜**: åªä½¿ç”¨äº† 500 ä¸ªæ ·æœ¬è®¡ç®— SHAP å€¼

**åŸå› **: SHAP è®¡ç®—è¾ƒæ…¢ï¼Œä½¿ç”¨å­é›†åŠ é€Ÿ

**å½±å“**:
- SHAP å€¼å¯èƒ½ä¸å®Œå…¨ä»£è¡¨æ•´ä½“
- æŸäº›ç½•è§æ¨¡å¼å¯èƒ½è¢«é—æ¼

**è§£å†³æ–¹æ¡ˆ**:
- å¢åŠ æ ·æœ¬æ•°åˆ° 1000 æˆ–å…¨éƒ¨
- æˆ–è€…ä½¿ç”¨åˆ†å±‚é‡‡æ ·ç¡®ä¿ä»£è¡¨æ€§

### 5. ç¼ºå°‘äº¤äº’ç‰¹å¾ âš ï¸

**é—®é¢˜**: æ²¡æœ‰æ˜¾å¼æ·»åŠ äº¤äº’ç‰¹å¾

**å½±å“**:
- å¯èƒ½é—æ¼äº†é‡è¦çš„äº¤äº’æ•ˆåº”
- ä¾‹å¦‚ï¼šå¹´è½»çš„è¿åŠ¨å‘˜ vs å¹´é•¿çš„æ¼”å‘˜

**è§£å†³æ–¹æ¡ˆ**:
- æ·»åŠ  age Ã— industry
- æ·»åŠ  week Ã— judge_score
- æ·»åŠ  age_above_40 äºŒå…ƒç‰¹å¾

---

## ğŸ¯ å…³é”®å†³ç­–è®°å½•

### Decision 1: ä½¿ç”¨ Random Forest è€Œé Gradient Boosting

**å†³ç­–**: ä½¿ç”¨ RandomForestRegressor

**ç†ç”±**:
- RF æ›´å®¹æ˜“è§£é‡Š
- RF å¯¹è¿‡æ‹Ÿåˆç›¸å¯¹ä¸æ•æ„Ÿï¼ˆä½†å®é™…ä¸Šè¿˜æ˜¯è¿‡æ‹Ÿåˆäº†ï¼‰
- RF ä¸ SHAP é…åˆæ›´å¥½ï¼ˆTreeExplainer é€Ÿåº¦å¿«ï¼‰

**å½±å“**: æ¨¡å‹å¯è§£é‡Šæ€§é«˜ï¼Œä½†å¯èƒ½ç‰ºç‰²äº†ä¸€äº›é¢„æµ‹ç²¾åº¦

### Decision 2: ä½¿ç”¨ LabelEncoder è€Œé One-Hot

**å†³ç­–**: å¯¹åˆ†ç±»ç‰¹å¾ä½¿ç”¨ LabelEncoder

**ç†ç”±**:
- é¿å…ç»´åº¦çˆ†ç‚¸ï¼ˆèˆä¼´æœ‰ 100+ ä¸ªï¼‰
- ç®€åŒ–å®ç°

**å½±å“**: å¼•å…¥äº†è™šå‡çš„é¡ºåºå…³ç³»ï¼Œå¯èƒ½å¯¼è‡´æ¨¡å‹å­¦åˆ°é”™è¯¯çš„æ¨¡å¼

**Alternatives Considered**: One-Hot Encoding, Target Encoding, Frequency Encoding

### Decision 3: max_depth = 10

**å†³ç­–**: è®¾ç½® max_depth = 10

**ç†ç”±**: æƒ³è¦çœ‹åˆ°æ¨¡å‹çš„æœ€å¤§æ‹Ÿåˆèƒ½åŠ›

**å½±å“**: å¯¼è‡´ä¸¥é‡è¿‡æ‹Ÿåˆï¼ˆCV RÂ² = -0.08ï¼‰

**Alternatives Considered**: max_depth = 5, max_depth = 3

### Decision 4: SHAP æ ·æœ¬æ•° = 500

**å†³ç­–**: ä½¿ç”¨ 500 ä¸ªæ ·æœ¬è®¡ç®— SHAP å€¼

**ç†ç”±**: å¹³è¡¡è®¡ç®—é€Ÿåº¦å’Œä»£è¡¨æ€§

**å½±å“**: SHAP å€¼å¯èƒ½ä¸å®Œå…¨ä»£è¡¨æ•´ä½“

**Alternatives Considered**: 1000 ä¸ªæ ·æœ¬ï¼Œå…¨éƒ¨æ ·æœ¬

---

## ğŸ“ æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•

- [ ] æµ‹è¯• `prepare_features()` çš„ç‰¹å¾ç¼–ç é€»è¾‘
- [ ] æµ‹è¯• `get_feature_importance()` çš„è¾“å‡ºæ ¼å¼
- [ ] æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼ˆæ ·æœ¬æ•° = 1, ç‰¹å¾ç¼ºå¤±ï¼‰

### é›†æˆæµ‹è¯•

- [ ] æµ‹è¯•å®Œæ•´çš„è®­ç»ƒæµç¨‹
- [ ] æµ‹è¯•æ¨¡å‹ä¿å­˜å’ŒåŠ è½½
- [ ] æµ‹è¯•åœ¨æµ‹è¯•é›†ä¸Šçš„é¢„æµ‹

### éªŒè¯æµ‹è¯•

- [ ] éªŒè¯ SHAP å€¼çš„æ€»å’Œæ˜¯å¦ç­‰äºé¢„æµ‹å€¼ - åŸºå‡†å€¼
- [ ] éªŒè¯ç‰¹å¾é‡è¦æ€§çš„æ€»å’Œæ˜¯å¦ä¸º 1
- [ ] éªŒè¯ RF å’Œ SHAP çš„ç‰¹å¾é‡è¦æ€§æ˜¯å¦ä¸€è‡´ï¼ˆè¶‹åŠ¿ï¼‰

---

## ğŸš€ åç»­å·¥ä½œå»ºè®®

### çŸ­æœŸï¼ˆç«‹å³æ‰§è¡Œï¼‰

1. **å‡å°‘è¿‡æ‹Ÿåˆ** â­â­â­
   - è°ƒæ•´è¶…å‚æ•°ï¼ˆmax_depth=5, min_samples_split=20ï¼‰
   - é‡æ–°è®­ç»ƒæ¨¡å‹
   - éªŒè¯äº¤å‰éªŒè¯ RÂ² æ˜¯å¦æå‡

2. **åœ¨æµ‹è¯•é›†ä¸ŠéªŒè¯** â­â­â­
   - ä½¿ç”¨ `ridge_fan_vote_shares_v2_test.csv`
   - åœ¨ S28-S34 ä¸Šæµ‹è¯• RF æ¨¡å‹
   - æŠ¥å‘Šæµ‹è¯•é›†æ€§èƒ½

3. **æ”¹è¿›ç‰¹å¾ç¼–ç ** â­â­
   - å°è¯• One-Hot Encodingï¼ˆè‡³å°‘å¯¹ industryï¼‰
   - æˆ–ä½¿ç”¨ Target Encoding

### ä¸­æœŸ

4. **æ·»åŠ äº¤äº’ç‰¹å¾** â­â­
   - age Ã— industry
   - week Ã— judge_score
   - age_above_40 äºŒå…ƒç‰¹å¾

5. **å¢åŠ  SHAP æ ·æœ¬æ•°** â­
   - ä» 500 å¢åŠ åˆ° 1000
   - æˆ–ä½¿ç”¨åˆ†å±‚é‡‡æ ·

6. **åˆ†æäº‰è®®æ¡ˆä¾‹** â­â­
   - ä½¿ç”¨ SHAP Force Plot è§£é‡Š Bobby Bones
   - ä½¿ç”¨ SHAP Force Plot è§£é‡Š Tinashe
   - å¯¹æ¯”ä¸¤è€…çš„ç‰¹å¾å·®å¼‚

### é•¿æœŸ

7. **å°è¯•å…¶ä»–æ¨¡å‹** â­
   - Gradient Boosting (XGBoost, LightGBM)
   - å¯èƒ½æœ‰æ›´å¥½çš„æ³›åŒ–èƒ½åŠ›

8. **é›†æˆ B1 å’Œ B2** â­
   - ä½¿ç”¨ RF çš„é¢„æµ‹ä½œä¸º Ridge çš„å…ˆéªŒ
   - Bayesian Ridge Regression

---

## ğŸ“‹ Review Checklist

è¯· Codex é‡ç‚¹æ£€æŸ¥ä»¥ä¸‹æ–¹é¢ï¼š

### é«˜ä¼˜å…ˆçº§ â­â­â­

- [ ] è¿‡æ‹Ÿåˆé—®é¢˜çš„ä¸¥é‡æ€§å’Œè§£å†³æ–¹æ¡ˆ
- [ ] ç‰¹å¾ç¼–ç æ–¹æ³•ï¼ˆLabelEncoderï¼‰çš„åˆç†æ€§
- [ ] SHAP åˆ†æçš„æ­£ç¡®æ€§
- [ ] æµ‹è¯•é›†éªŒè¯ç¼ºå¤±çš„å½±å“
- [ ] å…³é”® bug å’Œé€»è¾‘é”™è¯¯

### ä¸­ä¼˜å…ˆçº§ â­â­

- [ ] ä»£ç ç»“æ„å’Œå¯è¯»æ€§
- [ ] ç‰¹å¾å·¥ç¨‹çš„å®Œæ•´æ€§
- [ ] SHAP æ ·æœ¬é€‰æ‹©çš„åˆç†æ€§
- [ ] æ€§èƒ½ç“¶é¢ˆ
- [ ] æ–‡æ¡£å®Œæ•´æ€§

### ä½ä¼˜å…ˆçº§ â­

- [ ] å‘½åè§„èŒƒ
- [ ] æ³¨é‡Šé£æ ¼
- [ ] å¯è§†åŒ–ç¾åŒ–
- [ ] ä»£ç é‡å¤

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- `docs/14_model_b2_report.md` - RF è¯¦ç»†æŠ¥å‘Š
- `docs/16_fixes_and_shap_report.md` - ä¿®å¤å’Œ SHAP æŠ¥å‘Š
- `docs/06_decision_log.md` - å†³ç­–æ—¥å¿—

---

**äº¤æ¥å®Œæˆæ—¶é—´**: 2026-01-30 18:00
**çŠ¶æ€**: âœ… å‡†å¤‡å¥½è¿›è¡Œ Code Review
**ä¸‹ä¸€æ­¥**: Codex Review â†’ ä¿®å¤é—®é¢˜ â†’ å®ç° Model Cï¼ˆåäº‹å®æ¨¡æ‹Ÿï¼‰
